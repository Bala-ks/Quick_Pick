<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickPick - Nearby Products</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', Arial, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        /* App Bar */
        .app-bar {
            background-color: #1976D2;
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .app-title {
            font-weight: 700;
            font-size: 20px;
        }
        .app-bar-icon {
            color: white;
            cursor: pointer;
        }
        /* Content Area */
        .content-area {
            flex: 1;
            padding: 16px;
            padding-bottom: 70px; /* Space for bottom nav */
        }
        
        /* --- Radius Filter Container --- */
        .filter-container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
        }

        .filter-container label {
            font-size: 14px;
            color: #555;
            margin-right: 10px;
            font-weight: 500;
        }

        #radius-select {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: #fff;
            appearance: none; 
            cursor: pointer;
            outline: none;
            color: #1976D2;
            font-weight: 500;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #333;
        }
        
        /* === ENHANCED CARD STYLE === */
        .product-card {
            background-color: white;
            border-bottom: 1px solid #eee; 
            margin-bottom: 0;
            padding: 15px 0;
            overflow: hidden;
            display: flex; 
            align-items: flex-start;
            text-decoration: none;
            color: inherit;
        }
        
        .product-card:last-child {
            border-bottom: none;
        }

        .product-image {
            width: 120px; /* INCREASED SIZE */
            height: 120px; /* INCREASED SIZE */
            object-fit: cover;
            border-radius: 4px;
            flex-shrink: 0;
        }
        
        .product-details {
            padding: 0 0 0 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 120px; /* Match image height for vertical alignment */
        }
        
        .product-top-info {
            display: flex;
            flex-direction: column;
        }

        .product-name {
            font-weight: 500; /* Slightly bolder title */
            font-size: 17px; /* Slightly larger title */
            margin-bottom: 4px;
            line-height: 1.3;
            /* Max two lines for long titles */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .product-location-line {
            display: flex;
            align-items: center;
            color: #666;
            font-size: 13px;
            margin-bottom: 4px;
        }
        
        .product-location-line span {
            margin-right: 15px;
            display: flex;
            align-items: center;
        }

        .location-icon {
            font-size: 16px;
            margin-right: 4px;
            color: #999; 
        }
        
        .product-price {
            font-weight: 700;
            color: #FF5722; /* Orange color for price */
            font-size: 18px; /* Larger price */
            margin-top: 5px;
        }
        /* === END ENHANCED CARD STYLE === */

        /* Loading and Error States */
        .loading-container, .error-container, .location-prompt {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1976D2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .location-button {
            margin-top: 16px;
            padding: 10px 20px;
            background-color: #1976D2;
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .secondary-button {
            background-color: #4CAF50 !important;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        /* Fallback header */
        .fallback-header {
            background: #e3f2fd;
            border-left: 4px solid #1976D2;
            padding: 12px 16px;
            margin-bottom: 16px;
            border-radius: 4px;
            font-size: 14px;
            color: #1976D2;
        }
        
        /* Location Prompt */
        .location-prompt {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 4px;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            background-color: white;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            z-index: 100;
            height: 60px;
        }
        .nav-item {
            flex: 1;
            padding: 8px 0 0 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #666;
            text-decoration: none;
            font-size: 12px;
            cursor: pointer;
            height: 100%;
            transition: color 0.2s;
        }
        .nav-item.active {
            color: #1976D2;
        }
        .nav-icon {
            font-size: 24px;
            margin-bottom: 2px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-bar">
            <span class="material-icons app-bar-icon" id="menu-button">menu</span>
            <span class="app-title">QuickPick</span>
            <span class="material-icons app-bar-icon" id="search-button">search</span>
        </div>

        <div class="content-area" id="content-area">
            <div class="filter-container">
                <label for="radius-select">Radius:</label>
                <select id="radius-select">
                    <option value="5">5 km</option>
                    <option value="10">10 km</option>
                    <option value="20">20 km</option>
                    <option value="30">30 km</option>
                    <option value="50" selected>50 km</option>
                    <option value="100">100 km</option>
                    <option value="unlimited">Unlimited</option> 
                </select>
            </div>
            
            <div class="loading-container" id="loading-container">
                <div class="loading-spinner"></div>
                <p>Finding products near you...</p>
            </div>
            
            <div id="products-list-container">
                <!-- Products will be displayed here -->
            </div>
        </div>

        <div class="bottom-nav">
            <a class="nav-item active" id="home-nav" href="homepage.html">
                <span class="material-icons nav-icon">home</span>
                <span>Home</span>
            </a>
            <a class="nav-item" id="category-nav" href="categorypage.html">
                <span class="material-icons nav-icon">category</span>
                <span>Category</span>
            </a>
            <a class="nav-item" id="sell-nav" href="additem.html">
                <span class="material-icons nav-icon">add_box</span>
                <span>Sell</span>
            </a>
            <a class="nav-item" id="saved-nav" href="savedpage.html">
                <span class="material-icons nav-icon">shopping_cart</span>
                <span>Cart</span>
            </a>
            <a class="nav-item" id="profile-nav" href="profilepage.html">
                <span class="material-icons nav-icon">person</span>
                <span>Profile</span>
            </a>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script>
        // =========================================================================
        // Firebase Configuration & Initialization
        // =========================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDaDYNBIxppwwf3PtBKgz-14_6eVYQVRL0",
            authDomain: "quickpick-1523f.firebaseapp.com",
            projectId: "quickpick-1523f",
            storageBucket: "quickpick-1523f.appspot.com",
            messagingSenderId: "814647987706",
            appId: "1:814647987706:web:01595f83582fe3de0e2843",
            measurementId: "G-MMK0VWMY8T"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // =========================================================================
        // Global Variables
        // =========================================================================
        const loadingContainer = document.getElementById('loading-container');
        const radiusSelect = document.getElementById('radius-select');
        const productsListContainer = document.getElementById('products-list-container');

        let userLocation = null;
        let currentRadius = '50';
        let userCity = null;
        let locationAccessBlocked = false;

        // =========================================================================
        // MAIN INITIALIZATION - LOCATION FIRST PRIORITY
        // =========================================================================

        async function initApp() {
            console.log("Initializing app...");
            currentRadius = radiusSelect.value;
            
            // FIRST PRIORITY: Get current location and fetch nearby products
            await getCurrentLocationAndFetchProducts();
        }

        // =========================================================================
        // LOCATION-BASED PRODUCT FETCHING (FIRST PRIORITY)
        // =========================================================================

        async function getCurrentLocationAndFetchProducts() {
            console.log("Attempting to get current location...");
            
            if (!navigator.geolocation) {
                console.log("Geolocation not supported");
                showLocationNotSupported();
                return;
            }

            productsListContainer.innerHTML = '';
            loadingContainer.style.display = 'flex';
            loadingContainer.innerHTML = `
                <div class="loading-spinner"></div>
                <p>Getting your location...</p>
            `;

            navigator.geolocation.getCurrentPosition(
                // Success: Got location
                async (position) => {
                    console.log("Location obtained successfully");
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    locationAccessBlocked = false;
                    
                    loadingContainer.innerHTML = `
                        <div class="loading-spinner"></div>
                        <p>Finding products near you...</p>
                    `;
                    
                    // Fetch products based on distance from current location
                    await fetchProductsByDistance(userLocation, currentRadius);
                },
                // Error: Failed to get location
                async (error) => {
                    console.log("Location access failed:", error);
                    locationAccessBlocked = true;
                    loadingContainer.style.display = 'none';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            console.log("User denied location permission");
                            showLocationPermissionDenied();
                            break;
                        case error.POSITION_UNAVAILABLE:
                        case error.TIMEOUT:
                        default:
                            console.log("Location unavailable, trying city-based fallback");
                            // SECOND PRIORITY: Try city-based matching
                            await tryCityBasedFallback('location_unavailable');
                            break;
                    }
                },
                { 
                    enableHighAccuracy: true, 
                    timeout: 10000, 
                    maximumAge: 300000
                }
            );
        }

        // =========================================================================
        // DISTANCE-BASED PRODUCT FILTERING (FIRST PRIORITY)
        // =========================================================================

        async function fetchProductsByDistance(location, radiusValue) {
            console.log("Fetching products by distance...");
            
            const isUnlimited = radiusValue === 'unlimited';

            try {
                const productsCollection = await db.collection('products').get();
                const productsList = [];
                
                productsCollection.forEach(doc => {
                    const productData = doc.data();
                    
                    // Filter by status first
                    if (productData.status !== 'available') {
                        return;
                    }

                    let distance = null;

                    // Calculate distance for all products (even for unlimited, we still calculate but don't filter)
                    if (location.lat !== null && location.lng !== null) {
                        const productCoords = extractCoordinates(productData);
                        if (productCoords) {
                            distance = getDistance(
                                location.lat,
                                location.lng,
                                productCoords.lat,
                                productCoords.lng
                            ).toFixed(1);
                        }
                    }

                    // For unlimited radius, add all available products
                    // For limited radius, only add if within range
                    if (isUnlimited || (distance !== null && distance <= parseFloat(radiusValue))) {
                        productsList.push({
                            id: doc.id,
                            ...productData,
                            distance: distance,
                            matchType: 'distance'
                        });
                    }
                });

                loadingContainer.style.display = 'none';

                if (productsList.length === 0) {
                    console.log("No products found by distance, trying city fallback...");
                    // No products found by distance, try city-based fallback
                    await tryCityBasedFallback('no_products_nearby');
                } else {
                    console.log(`Found ${productsList.length} products by distance`);
                    displayProducts(productsList, radiusValue, false);
                }

            } catch (error) {
                console.error("Error fetching products by distance: ", error);
                loadingContainer.style.display = 'none';
                showError("Failed to fetch products. Please check your console for details.");
            }
        }

        // =========================================================================
        // CITY-BASED FALLBACK (SECOND PRIORITY)
        // =========================================================================

        async function tryCityBasedFallback(fallbackReason) {
            console.log("Attempting city-based fallback...");
            
            // Get user's city from Firestore
            userCity = await getUserCity();
            console.log("User city from profile:", userCity);
            
            if (!userCity) {
                console.log("No user city available, showing location error");
                showLocationError("We need your location to show nearby products.");
                return;
            }

            loadingContainer.style.display = 'flex';
            loadingContainer.innerHTML = `
                <div class="loading-spinner"></div>
                <p>Finding products in ${userCity}...</p>
            `;

            try {
                const productsCollection = await db.collection('products').get();
                const filteredProducts = [];
                
                productsCollection.forEach(doc => {
                    const productData = doc.data();
                    
                    if (productData.status !== 'available') {
                        return;
                    }

                    // Check if product has location text or city field
                    const productLocation = productData.location_text || productData.city || '';
                    if (!productLocation) {
                        return;
                    }

                    // Simple contains matching for city
                    if (doesCityMatch(userCity, productLocation)) {
                        filteredProducts.push({
                            id: doc.id,
                            ...productData,
                            distance: 'City Match',
                            matchType: 'city',
                            matchedCity: userCity
                        });
                    }
                });

                loadingContainer.style.display = 'none';

                if (filteredProducts.length === 0) {
                    console.log("No products found in user city");
                    showNoProductsWithCityFallback(userCity);
                } else {
                    console.log(`Found ${filteredProducts.length} products by city match`);
                    displayProducts(filteredProducts, currentRadius, true, userCity, fallbackReason);
                }

            } catch (error) {
                console.error("Error in city-based fallback: ", error);
                loadingContainer.style.display = 'none';
                showError("Failed to fetch products by city.");
            }
        }

        // =========================================================================
        // STRING MATCHING FUNCTIONS
        // =========================================================================

        function doesCityMatch(userCity, productLocation) {
            if (!userCity || !productLocation) return false;
            
            const userCityLower = userCity.toLowerCase().trim();
            const productLocationLower = productLocation.toLowerCase().trim();
            
            // Exact match
            if (productLocationLower.includes(userCityLower)) return true;
            
            // Word-based matching
            const userWords = userCityLower.split(/\s+/);
            const productWords = productLocationLower.split(/\s+/);
            
            for (let userWord of userWords) {
                if (userWord.length > 2) {
                    for (let productWord of productWords) {
                        if (productWord.length > 2 && 
                            (userWord.includes(productWord) || productWord.includes(userWord))) {
                            return true;
                        }
                    }
                }
            }
            
            return false;
        }

        // Fetch user's city from Firestore
        async function getUserCity() {
            try {
                const user = auth.currentUser;
                if (!user) return null;
                
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    
                    // Check different possible city fields
                    if (userData.locationData && userData.locationData.city) {
                        return userData.locationData.city;
                    } else if (userData.city) {
                        return userData.city;
                    } else if (userData.address) {
                        // Try to extract city from address string
                        const address = userData.address.toString();
                        const cityMatch = address.match(/([A-Za-z\s]+)(?:,|\s|$)/);
                        return cityMatch ? cityMatch[1].trim() : null;
                    }
                }
                return null;
            } catch (error) {
                console.error("Error fetching user city:", error);
                return null;
            }
        }

        // =========================================================================
        // UI RENDERING FUNCTIONS
        // =========================================================================

        function formatPrice(price) {
            return parseFloat(price).toLocaleString('en-IN', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            });
        }

        function displayProducts(products, radiusValue, isFallback = false, matchedCity = null, fallbackReason = null) {
            const isUnlimited = radiusValue === 'unlimited';

            let headerHTML = '';
            if (isFallback) {
                let headerText = '';
                let subText = '';
                
                switch(fallbackReason) {
                    case 'location_unavailable':
                        headerText = 'üìç Location Unavailable';
                        subText = `Showing products from ${matchedCity}`;
                        break;
                    case 'no_products_nearby':
                        headerText = 'üìç No Products Nearby';
                        subText = `Showing products from ${matchedCity}`;
                        break;
                    case 'location_blocked':
                        headerText = 'üìç Location Access Required';
                        subText = `Showing products from ${matchedCity}`;
                        break;
                    default:
                        headerText = `üìç Showing products from ${matchedCity}`;
                        subText = 'Based on your profile city';
                }
                
                headerHTML = `
                    <div class="fallback-header">
                        <strong>${headerText}</strong>
                        <br>
                        <small>${subText}</small>
                    </div>
                `;
            }

            productsListContainer.innerHTML = `
                ${headerHTML}
                <div id="products-list"></div>
            `;
            
            const productsList = document.getElementById('products-list');
            
            products.forEach(product => {
                const productCard = document.createElement('a');
                productCard.className = 'product-card';
                productCard.href = `productdetail.html?id=${product.id}`; 
                
                const imageUrl = product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/120x120?text=QuickPick';

                const locationText = product.location_text || '';
                const displayCategory = product.category ? product.category.charAt(0).toUpperCase() + product.category.slice(1) : 'General';
                
                // Distance/location display
                let distanceDisplay = '';
                if (isFallback) {
                    distanceDisplay = 'üìç ' + (locationText || matchedCity || 'Various Locations');
                } else if (isUnlimited) {
                    distanceDisplay = locationText || 'Location Not Specified';
                } else {
                    distanceDisplay = product.distance && product.distance !== 'null' 
                                    ? product.distance + ' km away' 
                                    : locationText || 'Location Not Specified';
                }

                productCard.innerHTML = `
                    <img src="${imageUrl}" alt="${product.title}" class="product-image">
                    <div class="product-details">
                        <div class="product-top-info">
                            <h3 class="product-name">${product.title}</h3>
                            
                            <div class="product-location-line">
                                <span class="location-text">
                                    <span class="material-icons location-icon">location_on</span>
                                    ${distanceDisplay}
                                </span>
                                <span class="category-text">
                                    ${displayCategory}
                                </span>
                            </div>
                            ${isFallback ? '<span style="color: #4CAF50; font-size: 12px; display: block; margin-top: 4px;">üìç City Match</span>' : ''}
                        </div>

                        <span class="product-price">‚Çπ${formatPrice(product.price)}</span>
                    </div>
                `;
                productsList.appendChild(productCard);
            });
        }

        // =========================================================================
        // ERROR AND PROMPT FUNCTIONS
        // =========================================================================

        function showLocationPermissionDenied() {
            productsListContainer.innerHTML = `
                <div class="location-prompt">
                    <span class="material-icons" style="font-size: 48px; color: #ff9800; margin-bottom: 16px;">location_off</span>
                    <h3>Location Access Required</h3>
                    <p>To show products near you, we need access to your location.</p>
                    <div class="button-group">
                        <button class="location-button" onclick="retryLocationAccess()">
                            <span class="material-icons">my_location</span>
                            Allow Location Access
                        </button>
                        <button class="location-button secondary-button" onclick="tryCityBasedFallback('location_blocked')">
                            <span class="material-icons">explore</span>
                            Browse by My City
                        </button>
                    </div>
                    <p style="margin-top: 12px; font-size: 12px; color: #666;">
                        Or change radius to "Unlimited" to see all products
                    </p>
                </div>
            `;
        }

        function showLocationError(message) {
            productsListContainer.innerHTML = `
                <div class="error-container">
                    <span class="material-icons" style="font-size: 48px; color: #f44336; margin-bottom: 16px;">error_outline</span>
                    <p>${message}</p>
                    <div class="button-group">
                        <button class="location-button" onclick="retryLocationAccess()">
                            <span class="material-icons">my_location</span>
                            Retry Location
                        </button>
                        <button class="location-button secondary-button" onclick="useUnlimitedRadius()">
                            <span class="material-icons">explore</span>
                            Show All Products
                        </button>
                    </div>
                </div>
            `;
        }

        function showNoProductsWithCityFallback(userCity) {
            productsListContainer.innerHTML = `
                <div class="error-container">
                    <span class="material-icons" style="font-size: 48px; color: #666; margin-bottom: 16px;">location_searching</span>
                    <p>No available products found in <strong>${userCity}</strong>.</p>
                    <div class="button-group">
                        <button class="location-button" onclick="retryLocationAccess()">
                            <span class="material-icons">my_location</span>
                            Try Location Again
                        </button>
                        <button class="location-button secondary-button" onclick="useUnlimitedRadius()">
                            <span class="material-icons">explore</span>
                            Show All Products
                        </button>
                    </div>
                </div>
            `;
        }

        function showLocationNotSupported() {
            productsListContainer.innerHTML = `
                <div class="error-container">
                    <span class="material-icons" style="font-size: 48px; color: #f44336; margin-bottom: 16px;">error</span>
                    <p>Geolocation is not supported by your browser.</p>
                    <button class="location-button secondary-button" onclick="useUnlimitedRadius()" style="margin-top: 16px;">
                        <span class="material-icons">explore</span>
                        Show All Products
                    </button>
                </div>
            `;
        }

        function showError(message) {
            productsListContainer.innerHTML = `
                <div class="error-container">
                    <span class="material-icons" style="font-size: 48px; color: #f44336; margin-bottom: 16px;">error_outline</span>
                    <p>${message}</p>
                </div>
            `;
        }

        // =========================================================================
        // UTILITY FUNCTIONS
        // =========================================================================

        function retryLocationAccess() {
            getCurrentLocationAndFetchProducts();
        }

        function useUnlimitedRadius() {
            radiusSelect.value = 'unlimited';
            currentRadius = 'unlimited';
            fetchProductsByDistance(userLocation || {lat: null, lng: null}, 'unlimited');
        }

        // Haversine formula to calculate distance between two lat/lng points
        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of Earth in kilometers
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                        Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const d = R * c; // Distance in km
            return d;
        }

        function extractCoordinates(productData) {
            let lat = null;
            let lng = null;

            if (productData.geo && typeof productData.geo.latitude === 'number' && typeof productData.geo.longitude === 'number') {
                lat = productData.geo.latitude;
                lng = productData.geo.longitude;
            } else if (productData.location && typeof productData.location === 'string') {
                const parts = productData.location.split(',');
                if (parts.length >= 2) {
                    lat = parseFloat(parts[0].replace(/[^0-9.-]/g, ''));
                    lng = parseFloat(parts[1].replace(/[^0-9.-]/g, ''));
                }
            }
            
            if (!isNaN(lat) && !isNaN(lng)) {
                return { lat, lng };
            }
            return null;
        }

        // =========================================================================
        // EVENT HANDLERS
        // =========================================================================

        radiusSelect.addEventListener('change', function() {
            currentRadius = this.value;
            
            if (currentRadius === 'unlimited') {
                fetchProductsByDistance(userLocation || {lat: null, lng: null}, currentRadius);
            } else if (userLocation) {
                fetchProductsByDistance(userLocation, currentRadius);
            } else {
                getCurrentLocationAndFetchProducts();
            }
        });

        // Navigation handlers
        document.getElementById('category-nav').addEventListener('click', (e) => { e.preventDefault(); window.location.href = "categorypage.html"; });
        document.getElementById('home-nav').addEventListener('click', (e) => { e.preventDefault(); window.location.href = "homepage.html"; });
        document.getElementById('saved-nav').addEventListener('click', (e) => { e.preventDefault(); window.location.href = "savedpage.html"; });
        document.getElementById('profile-nav').addEventListener('click', (e) => { e.preventDefault(); window.location.href = "profilepage.html"; });
        document.getElementById('sell-nav').addEventListener('click', (e) => { e.preventDefault(); window.location.href = "additem.html"; });

        // Initialize the app
        initApp();
    </script>
</body>
</html>